## 2026-02-03 Handoff Notes

### Modal style unification
- All `components/*Modal.tsx` wrappers now use `styles/modalStyles.ts` for shared classes.
- `MODAL_CONTAINER_CLASS` aligns with `AddMonsterModal` (`px-3 py-3`), and `Modal` `size` prop is used instead of local `max-w-*`.
- Common button styles now include text colors in `modalStyles` (primary/secondary/warning/danger).
- `AddMonsterModal` and `MonsterSettingsModal` no longer define local style constants.
- `SessionExpiredModal` no longer uses the `Modal` `title` prop; it uses the standard wrapper + `h2`.

### Personal items/abilities/spells flow
- Characters can create **personal** items/abilities/spells without a global entry (`*_id` now nullable in `character_*` tables).
- Upload to global requires **all fields** and includes **name_en case-insensitive deduplication**.
- Upload flow shows a confirmation dialog before creating or linking global entries.
- New personal-create modals: `AddPersonalItemModal`, `AddPersonalAbilityModal`, `AddPersonalSpellModal`.
- Learn modals rename "新增到資料庫" to personal actions and open the new personal modals when not found.

### Database migrations
- `supabase/migrations/20260203120000_update_items_personal_and_global_name_en_unique.sql`
- `supabase/migrations/20260203133000_update_abilities_personal_and_name_en_unique.sql`
- `supabase/migrations/20260203140000_update_spells_personal_and_name_en_unique.sql`

### Services updated
- `services/itemService.ts`, `services/abilityService.ts`, `services/spellService.ts`
  - create personal entries (`*_id: null`)
  - upload to global with dedup by `name_en` (case-insensitive)

### UI updates (examples)
- `components/ItemsPage.tsx`, `AbilitiesPage.tsx`, `SpellsPage.tsx`
- `components/ItemDetailModal.tsx`, `AbilityDetailModal.tsx`, `SpellDetailModal.tsx`
- `components/GlobalItemFormModal.tsx`, `AbilityFormModal.tsx`, `SpellFormModal.tsx`

### Files touched (examples)
- `styles/modalStyles.ts`
- `components/AddMonsterModal.tsx`
- `components/MonsterSettingsModal.tsx`
- `components/SessionExpiredModal.tsx`
- other modal components (see git history for full list)

### Tests
- Full suite passed: `npm test` (19 files / 245 tests).
