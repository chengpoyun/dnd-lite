# AI 協作工作流（AI Workflow）

> 適用對象：在本專案中開發的人員，以及協助開發的 AI 助手。目標是透過明確流程，確保需求被充分理解、有可執行的測試策略、實作可驗證且不破壞既有功能。  
> 開發流程總覽見 [README-project.md](../README-project.md)。

---

## 流程總覽

1. **確認需求**：釐清目標、輸入輸出、邊界與影響範圍。
2. **設計驗收與測試**：定義「完成」的標準與測試案例。
3. **先實作測試**：寫好對應的單元／元件測試（預期先失敗）。
4. **再實作需求**：依專案慣例實作功能。
5. **執行本次測試**：確認與本次需求相關的測試全部通過。
6. **執行完整單元測試**：跑 `npm test`，確保沒有回歸。
7. **回報結果**：向需求提出者回報摘要、測試說明與建議。

---

## 詳細守則

### 1. 需求確認（必須先討論）

在動手實作前，先與需求提出者確認：

- **需求目標**：期望達成的行為或效果。
- **輸入與輸出**：資料格式、介面、UI/UX。
- **邊界與例外**：邊界條件、錯誤情境。
- **影響範圍**：是否牽涉現有功能或其他模組。

有不確定處應主動發問，直到需求足以實作與測試為止。

### 2. 設計測試與驗收方式

需求確認後，先說明：

- **如何判斷需求「完成」？**
- **測試案例**：正常情境（Happy path）、邊界情境、錯誤／例外情境（若適用）。

盡量以自動化測試（單元測試、元件測試）呈現，並讓需求提出者確認。

### 3. 先實作測試

在寫功能碼之前，先寫對應的測試，例如：

- 單元測試（`*.test.ts`）
- 元件測試（`*.test.tsx`）
- API 或整合測試（若與需求相關）

原則：測試應對應需求中的驗收條件；在功能尚未實作時，測試預期會失敗（紅燈）。

### 4. 再實作需求

測試寫好後才開始實作：

- 遵守專案既有風格、架構與慣例（見 [code-architecture.md](code-architecture.md)）。
- 修改既有程式碼時注意對其他功能的影響。
- 變更盡量聚焦在該需求與相關測試上。

### 5. 執行本次設計的測試

實作完成後：

- 執行第 3 步所寫的測試。
- 確認全部通過；若失敗，先修正實作或測試再重跑。

### 6. 執行完整單元測試

為避免回歸：

- 執行專案完整測試：`npm test`（或專案約定的指令）。
- 確認既有測試均通過；若有與本次變更相關的測試變動，需有合理說明。
- 若有失敗，需調查並修正直到通過。

### 7. 回報需求完成狀態

流程完成後，向需求提出者回報，內容至少包含：

- **需求摘要**：做了什麼、為何這樣做。
- **測試說明**：新增或修改了哪些測試、相關測試是否通過。
- **完整測試結果**：已執行且通過。
- **影響範圍與後續建議**（若有）。
- **需人工介入或決策的部分**（若有）。

---

## 檢查清單（Checklist）

開發時可依序勾選：

- [ ] 需求已確認（目標、輸入輸出、邊界、影響範圍）
- [ ] 驗收條件與測試案例已設計並經確認
- [ ] 已先撰寫或擴充測試（預期先失敗）
- [ ] 已依專案慣例實作功能
- [ ] 本次需求相關測試全部通過
- [ ] `npm test` 完整測試通過
- [ ] 已回報完成狀態與測試結果

---

## 適用範圍

- **優先適用**：影響邏輯、資料或 API 的變更；會影響多處功能的重構。
- **可簡化**：極小且風險低的變更（例如純文案）可簡化測試流程，但仍建議至少思考並說明驗收方式。

---

## 相關文件

- [README-project.md](../README-project.md)：開發流程與「新增功能建議步驟」
- [TEST-README.md](../TEST-README.md)：測試撰寫與執行
- [code-architecture.md](code-architecture.md)：程式風格與測試慣例
