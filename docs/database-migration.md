# è‡ªå‹•è³‡æ–™åº«é·ç§»ç³»çµ±

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. å‰µå»ºæ–°çš„è³‡æ–™åº«é·ç§»
```bash
npm run db:create "add_new_feature"
```

### 2. åŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼ˆè‡ªå‹•æ¨é€åˆ° Supabaseï¼‰
```bash
npm run db:migrate
```

### 3. æŸ¥çœ‹é·ç§»ç‹€æ…‹
```bash
npm run db:status
```

## ğŸ“ è©³ç´°èªªæ˜

### å‰µå»ºæ–°é·ç§»
- é‹è¡Œ `npm run db:create "é·ç§»æè¿°"`
- æœƒåœ¨ `supabase/migrations/` ç›®éŒ„ä¸‹å‰µå»ºæ–°çš„ SQL æ–‡ä»¶
- ç·¨è¼¯è©²æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ SQL æŒ‡ä»¤
- è¨˜å¾—æ·»åŠ  `IF NOT EXISTS` ä¾†é¿å…è¡çª

### è‡ªå‹•é·ç§»
- é‹è¡Œ `npm run db:migrate`
- è‡ªå‹•æª¢æŸ¥ä¸¦æ¨é€æ‰€æœ‰æœªæ‡‰ç”¨çš„é·ç§»
- åŒ…å«éŒ¯èª¤æª¢æŸ¥å’Œç‹€æ…‹ç¢ºèª
  - CLI ä¾†æºå„ªå…ˆé †åºï¼š
    - å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `./supabase-cli`
    - è‹¥ç„¡ï¼Œä½¿ç”¨ PATH ä¸­çš„ `supabase`
  - **é‡è¦**ï¼šåªè¦æœ‰æ–°å¢ migrationï¼Œå¿…é ˆç«‹å³æ¨é€åˆ°é ç«¯ DB

### é·ç§»æ–‡ä»¶å‘½å
- æ ¼å¼ï¼š`YYYYMMDDHHMMSS_description.sql`
- ä¾‹å¦‚ï¼š`20260126123456_add_user_preferences.sql`

## âš ï¸ æ³¨æ„äº‹é …

1. **å‚™ä»½é‡è¦**ï¼šæ¯æ¬¡é·ç§»å‰å»ºè­°å…ˆå‚™ä»½é‡è¦è³‡æ–™
2. **æ¸¬è©¦å…ˆè¡Œ**ï¼šåœ¨é–‹ç™¼ç’°å¢ƒå…ˆæ¸¬è©¦é·ç§»
3. **RLS æ”¿ç­–**ï¼šè¨˜å¾—ç‚ºæ–°è¡¨æ ¼æ·»åŠ é©ç•¶çš„å®‰å…¨æ”¿ç­–
4. **ç´¢å¼•å„ªåŒ–**ï¼šç‚ºç¶“å¸¸æŸ¥è©¢çš„æ¬„ä½æ·»åŠ ç´¢å¼•

## ğŸ”§ ç’°å¢ƒè¨­å®š

ç¢ºä¿ `.env` æ–‡ä»¶åŒ…å«ï¼š
```bash
SUPABASE_ACCESS_TOKEN=your_token_here
```

ä¸¦ç¢ºä¿æœ¬æ©Ÿå·²å®‰è£ Supabase CLIï¼ˆPATH å¯æ‰¾åˆ° `supabase`ï¼‰ï¼Œæˆ–å°‡ `supabase-cli` æ”¾åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ã€‚

## ğŸ“‚ æ–‡ä»¶çµæ§‹

```
supabase/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 20260126000001_detailed_character_schema.sql
â”‚   â””â”€â”€ [æ–°çš„é·ç§»æ–‡ä»¶...]
â””â”€â”€ config.toml

scripts/
â”œâ”€â”€ auto-migrate.sh     # è‡ªå‹•é·ç§»è…³æœ¬
â””â”€â”€ create-migration.sh # å‰µå»ºé·ç§»è…³æœ¬
```

## ğŸ¯ æœ€ä½³å¯¦è¸

1. **å‘½åæ¸…æ™°**ï¼šä½¿ç”¨æè¿°æ€§çš„é·ç§»åç¨±
2. **åŸå­æ“ä½œ**ï¼šæ¯å€‹é·ç§»å°ˆæ³¨æ–¼å–®ä¸€è®Šæ›´
3. **å‘ä¸‹ç›¸å®¹**ï¼šä½¿ç”¨ `ALTER TABLE` è€Œé `DROP TABLE`
4. **æ¸¬è©¦å®Œæ•´**ï¼šç¢ºä¿é·ç§»åœ¨ä¸åŒæ•¸æ“šç‹€æ…‹ä¸‹éƒ½èƒ½æ­£å¸¸é‹è¡Œ