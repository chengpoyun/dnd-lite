# D&D Lite å°ˆæ¡ˆ - AI åŠ©ç†å·¥ä½œæŒ‡å—

## ğŸ“ æ ¸å¿ƒå·¥ä½œåŸå‰‡

### 1. ğŸ”„ ä¿®æ”¹å‰è¨è«– (åŸå‰‡)
- **é‡å¤§ä¿®æ”¹å‰å¿…é ˆå…ˆèªªæ˜è¨ˆåŠƒ**
- è©³ç´°è§£é‡‹ï¼šä¿®æ”¹å…§å®¹ã€åŸå› ã€é æœŸæ•ˆæœ
- **ç­‰å¾…ç”¨æˆ¶ç¢ºèªã€Œå¯ä»¥ã€å¾Œæ‰é–‹å§‹åŸ·è¡Œ**

**ğŸ¯ å¯ç›´æ¥åŸ·è¡Œçš„ç°¡å–®ä¿®æ”¹**ï¼š
- ä¿®æ­£æ‹¼å­—éŒ¯èª¤ã€èªæ³•éŒ¯èª¤
- èª¿æ•´æ–‡å­—å…§å®¹ã€è¨»è§£æ›´æ–°
- ç°¡å–®çš„æ¨£å¼èª¿æ•´ï¼ˆé¡è‰²ã€é–“è·ç­‰ï¼‰
- æ–‡æª”å…§å®¹æ›´æ–°
- ä¸æ¶‰åŠæ¶æ§‹æˆ–é‚è¼¯çš„ä¿®æ”¹

**âš ï¸ å¿…é ˆè¨è«–çš„é‡å¤§ä¿®æ”¹**ï¼š
- æ–°å¢æˆ–ä¿®æ”¹åŠŸèƒ½é‚è¼¯
- è³‡æ–™åº«çµæ§‹è®Šæ›´
- API ä»‹é¢èª¿æ•´
- çµ„ä»¶æ¶æ§‹ä¿®æ”¹
- å®‰å…¨æ€§ç›¸é—œè®Šæ›´

### 2. âœ… ä¿®æ”¹å¾Œé©—è­‰ (è‡ªå‹•åŸ·è¡Œ)
- ä¿®æ”¹å®Œæˆå¾Œç«‹å³æª¢æŸ¥çµæœæ˜¯å¦ç¬¦åˆè¨è«–å…§å®¹
- ç™¼ç¾åå·®æ™‚ä¸»å‹•ä¿®æ­£ï¼Œä»¥è¨è«–çµæœç‚ºæº–
- ç¢ºä¿æœ€çµ‚çµæœèˆ‡ç´„å®šå…§å®¹å®Œå…¨ä¸€è‡´

### 3. ğŸ“Š å°ˆæ¡ˆç‹€æ…‹é€æ˜åŒ–
- æ¯æ¬¡ä¿®æ”¹å¾Œæ›´æ–°å°ˆæ¡ˆç‹€æ…‹
- è¨˜éŒ„å·²çŸ¥å•é¡Œå’Œè§£æ±ºé€²åº¦
- ä¿æŒå·¥ä½œæµç¨‹å¯è¿½è¹¤

### 4. ğŸ§ª å–®å…ƒæ¸¬è©¦å·¥ä½œåŸå‰‡ (å¿…é ˆéµå®ˆ)
**ğŸ¯ ç¢ºä¿ä»£ç¢¼å“è³ªå’Œé˜²æ­¢å›æ­¸å•é¡Œ**

**å¿…é ˆåŸ·è¡Œçš„æ¸¬è©¦æª¢æŸ¥ï¼š**
- **æ‰€æœ‰ä¿®æ”¹éƒ½éœ€ç¢ºèªå–®å…ƒæ¸¬è©¦æ²’æœ‰å•é¡Œ** - æ¯æ¬¡ä»£ç¢¼è®Šæ›´å¾Œéƒ½è¦åŸ·è¡Œ `npm test` ç¢ºä¿ç¾æœ‰æ¸¬è©¦é€šé
- **æ¯æ¬¡æˆåŠŸä¿®å¾©ä¸€å€‹å•é¡Œï¼Œéƒ½è¦è€ƒæ…®æ˜¯å¦æ–°å¢ç›¸é—œçš„å–®å…ƒæ¸¬è©¦** - ç‚ºä¿®å¾©çš„ bug å»ºç«‹æ¸¬è©¦æ¡ˆä¾‹é˜²æ­¢å†æ¬¡ç™¼ç”Ÿ
- **æ¯æ¬¡å¯¦ä½œå®Œç•¢ä¸€å€‹æ–°åŠŸèƒ½ï¼Œéƒ½è¦è€ƒæ…®æ˜¯å¦æ–°å¢ç›¸é—œçš„å–®å…ƒæ¸¬è©¦** - ç‚ºæ–°åŠŸèƒ½å»ºç«‹å®Œæ•´æ¸¬è©¦è¦†è“‹ç‡

**æ¸¬è©¦æœ€ä½³å¯¦å‹™ï¼š**
- âœ… åœ¨ä¿®æ”¹æ ¸å¿ƒé‚è¼¯å‰å…ˆé‹è¡Œæ¸¬è©¦ç¢ºä¿èµ·å§‹ç‹€æ…‹æ­£å¸¸
- âœ… ä½¿ç”¨æ¸¬è©¦ä¿è­·è…³æœ¬ `./test-protection.sh` é©—è­‰æ¸¬è©¦èƒ½æ•ç²ç ´å£æ€§ä¿®æ”¹
- âœ… é‡å°è³‡æ–™ä¿å­˜ã€ç”¨æˆ¶äº’å‹•ã€éŒ¯èª¤è™•ç†å»ºç«‹æ¸¬è©¦æ¡ˆä¾‹
- âœ… éµå¾ªæ¸¬è©¦æ–‡æª” `src/test/TEST-README.md` çš„æŒ‡å¼•

### 5. ğŸ”„ è³‡æ–™æŒä¹…åŒ–æª¢æŸ¥æ¸…å–® (é˜²æ­¢å›æ­¸å•é¡Œ)
**ğŸ¯ æ¯æ¬¡ä¿®æ”¹æ¶‰åŠç‹€æ…‹æ›´æ–°æ™‚å¿…é ˆæª¢æŸ¥**

**å¿…é ˆç¢ºèªçš„äº‹é …ï¼š**
- **æœ¬åœ°ç‹€æ…‹æ›´æ–°å¾Œï¼Œæ˜¯å¦éœ€è¦ä¿å­˜åˆ°æ•¸æ“šåº«ï¼Ÿ** - ä»»ä½• `setState` æˆ–ç‹€æ…‹ä¿®æ”¹éƒ½è¦æª¢æŸ¥æ˜¯å¦éœ€è¦å°æ‡‰çš„ä¿å­˜æ“ä½œ
- **ç”¨æˆ¶æ“ä½œå®Œæˆå¾Œï¼Œè³‡æ–™æ˜¯å¦æœƒæŒä¹…åŒ–ï¼Ÿ** - ç‰¹åˆ¥æ³¨æ„ä¸Šå‚³ã€ç·¨è¼¯ã€æ–°å¢ç­‰æ“ä½œ
- **é é¢é‡è¼‰å¾Œï¼Œä¿®æ”¹çš„è³‡æ–™æ˜¯å¦é‚„å­˜åœ¨ï¼Ÿ** - é€™æ˜¯æœ€é‡è¦çš„é©—è­‰é»

**é«˜é¢¨éšªæ“ä½œæ¸…å–®ï¼š**
- ğŸ”´ **åœ–ç‰‡/æª”æ¡ˆä¸Šå‚³** - å¿…é ˆæœ‰å°æ‡‰çš„ URL ä¿å­˜å‡½æ•¸
- ğŸ”´ **è¡¨å–®è¼¸å…¥** - ç¢ºèªæœ‰ onSave å›èª¿å’Œæ•¸æ“šåº«æ›´æ–°
- ğŸ”´ **æ‹–æ”¾æ’åº** - é †åºæ”¹è®Šéœ€è¦ç«‹å³ä¿å­˜
- ğŸ”´ **é–‹é—œåˆ‡æ›** - å¸ƒæ—å€¼è®Šæ›´è¦è§¸ç™¼ä¿å­˜
- ğŸ”´ **æ–°å¢/åˆªé™¤é …ç›®** - åˆ—è¡¨è®Šæ›´å¿…é ˆåŒæ­¥åˆ°æ•¸æ“šåº«

**é–‹ç™¼è‡ªæˆ‘æª¢æŸ¥æµç¨‹ï¼š**
1. **ä¿®æ”¹å‰** - ç¢ºèªç¾æœ‰ä¿å­˜æ©Ÿåˆ¶
2. **ä¿®æ”¹ä¸­** - æ¯å€‹ç‹€æ…‹æ›´æ–°éƒ½é…å°ä¸€å€‹ä¿å­˜æ“ä½œ  
3. **ä¿®æ”¹å¾Œ** - æ¸¬è©¦é‡è¼‰å¾Œè³‡æ–™æ˜¯å¦æŒçºŒå­˜åœ¨
4. **æ¸¬è©¦ä¿è­·** - ç‚ºæ–°åŠŸèƒ½æ·»åŠ å°æ‡‰æ¸¬è©¦æ¡ˆä¾‹

### 6. ğŸ¯ ç¨ç«‹ä¿å­˜å‡½æ•¸è¨­è¨ˆåŸå‰‡ (å¿…é ˆéµå®ˆ)
**ğŸ¯ æ¯å€‹å¯ä¿®æ”¹çš„æ•¸å€¼éƒ½æ‡‰è©²æœ‰å°ˆå±¬çš„ä¿å­˜å‡½æ•¸**

**è¨­è¨ˆåŸå‰‡ï¼š**
- **å–®ä¸€è·è²¬** - æ¯å€‹ä¿å­˜å‡½æ•¸åªè² è²¬ä¸€å€‹ç‰¹å®šæ•¸å€¼æˆ–ç›¸é—œæ•¸å€¼çµ„
- **ç²¾ç¢ºæ›´æ–°** - åªæ›´æ–°è¢«ä¿®æ”¹çš„ç‰¹å®šå€¼ï¼Œé¿å…ä¸å¿…è¦çš„æ•¸æ“šåº«æ“ä½œ
- **ç¨ç«‹æ€§** - å„å€¼çš„ä¿®æ”¹å’Œä¿å­˜äº’ä¸å½±éŸ¿ï¼Œå¤±æ•—ä¸æœƒé€£å¸¶å…¶ä»–å€¼
- **æ¸…æ™°å‘½å** - å‡½æ•¸åç¨±æ˜ç¢ºæŒ‡å‡ºä¿å­˜çš„å…§å®¹ (å¦‚ `saveHP`, `saveAC`, `saveInitiative`)

**å¯¦æ–½æ¨¡å¼ï¼š**
```typescript
// âœ… æ¨è–¦ï¼šç¨ç«‹ä¿å­˜å‡½æ•¸
const saveHP = async (current: number, max: number) => Promise<boolean>
const saveAC = async (ac: number) => Promise<boolean>  
const saveInitiative = async (initiative: number) => Promise<boolean>

// âŒ é¿å…ï¼šå¤§å‹ç¶œåˆä¿å­˜å‡½æ•¸
const saveAllStats = async (stats: CharacterStats) => Promise<boolean>
```

**å„ªå‹¢èªªæ˜ï¼š**
- **æ€§èƒ½å„ªåŒ–** - åªå‚³è¼¸å’Œæ›´æ–°å¿…è¦çš„æ•¸æ“š
- **éŒ¯èª¤å®šä½** - å¯ä»¥ç²¾ç¢ºçŸ¥é“å“ªå€‹å€¼ä¿å­˜å¤±æ•—
- **ç”¨æˆ¶é«”é©—** - éƒ¨åˆ†ä¿å­˜å¤±æ•—ä¸å½±éŸ¿å…¶ä»–å·²æˆåŠŸä¿å­˜çš„å€¼
- **ç¶­è­·æ€§** - ä¿®æ”¹ç‰¹å®šå€¼çš„ä¿å­˜é‚è¼¯ä¸å½±éŸ¿å…¶ä»–å€¼

## å°ˆæ¡ˆç‰¹å®šè¦å‰‡

### ä»£ç¢¼é¢¨æ ¼
- ä½¿ç”¨ TypeScript åš´æ ¼æ¨¡å¼
- React çµ„ä»¶ä½¿ç”¨å‡½æ•¸å¼å¯«æ³•
- å„ªå…ˆä½¿ç”¨ async/await è€Œé Promise.then()

### è³‡æ–™åº«æ“ä½œ
- æ°¸é ä½¿ç”¨ Databaseï¼Œé¿å… localStorage
- æ‰€æœ‰è³‡æ–™æ“ä½œéƒ½è¦æœ‰éŒ¯èª¤è™•ç†
- ä½¿ç”¨ Supabase çš„ RLS æ”¿ç­–ç¢ºä¿å®‰å…¨æ€§
- **ğŸ”‘ ç‹€æ…‹æŒä¹…åŒ–é»ƒé‡‘åŸå‰‡ï¼šæ¯å€‹ç”¨æˆ¶æ“ä½œçš„ç‹€æ…‹è®Šæ›´éƒ½å¿…é ˆæœ‰å°æ‡‰çš„æ•¸æ“šåº«ä¿å­˜æ©Ÿåˆ¶**

### ğŸ›¢ï¸ è³‡æ–™åº«é·ç§»å®‰å…¨åŸå‰‡ (å¿…é ˆéµå®ˆ)
**ğŸš¨ æ‰€æœ‰ DB Migration éƒ½å¿…é ˆç¢ºä¿åŸæœ‰è³‡æ–™ä¸æœƒææ¯€**

**å¿…é ˆåŸ·è¡Œçš„å®‰å…¨æª¢æŸ¥ï¼š**
1. **å‚™ä»½é©—è­‰** - ç¢ºèªé‡è¦è³‡æ–™å·²å‚™ä»½æˆ–å¯æ¢å¾©
2. **å‘ä¸‹å…¼å®¹** - æ–°çµæ§‹å¿…é ˆæ”¯æ´ç¾æœ‰è³‡æ–™æ ¼å¼
3. **è³‡æ–™ä¿è­·** - ä½¿ç”¨ `ALTER` æ·»åŠ æ¬„ä½ï¼Œé¿å… `DROP` åˆªé™¤æ¬„ä½
4. **æ¸¬è©¦é©—è­‰** - Migration å¾Œç¢ºèªç¾æœ‰åŠŸèƒ½æ­£å¸¸é‹ä½œ
5. **å›æ»¾æº–å‚™** - æº–å‚™åå‘æ“ä½œä»¥é˜²éœ€è¦å›é€€

**ç¦æ­¢çš„å±éšªæ“ä½œï¼š**
- âŒ `DROP TABLE` - åˆªé™¤è¡¨æ ¼
- âŒ `DROP COLUMN` - åˆªé™¤æ¬„ä½ (é™¤éç¢ºèªç„¡è³‡æ–™)
- âŒ `ALTER COLUMN ... DROP` - åˆªé™¤ç´„æŸæˆ–é è¨­å€¼
- âŒ æ²’æœ‰å‚™ä»½çš„æ‰¹é‡ `UPDATE` æˆ– `DELETE`

**æ¨è–¦çš„å®‰å…¨åšæ³•ï¼š**
- âœ… `ALTER TABLE ... ADD COLUMN` - æ·»åŠ æ–°æ¬„ä½
- âœ… `CREATE INDEX IF NOT EXISTS` - å®‰å…¨å‰µå»ºç´¢å¼•
- âœ… ä½¿ç”¨ `COALESCE` è™•ç† NULL å€¼
- âœ… åˆ†éšæ®µé·ç§»ï¼šå…ˆæ·»åŠ ï¼Œå¾Œé·ç§»è³‡æ–™ï¼Œæœ€å¾Œæ¸…ç†

### Migration æ¨™æº–æµç¨‹ (é ç«¯ Supabase)
1. **å®‰å…¨æ€§è©•ä¼°** â†’ æª¢æŸ¥ Migration æ˜¯å¦æœƒææ¯€è³‡æ–™
2. **å»ºç«‹ migration æ–‡ä»¶** â†’ å‰µå»ºæ–°çš„ `.sql` æª”æ¡ˆ
3. **åŸ·è¡Œ migration** â†’ âš ï¸ **é€éä»¥ä¸‹æ–¹å¼æ¨é€åˆ°é ç«¯**ï¼š
   ```bash
   # å¾ .env è®€å– SUPABASE_ACCESS_TOKEN ä¸¦åŸ·è¡Œæ¨é€
   cd /home/barry/dnd-lite && \
   export $(cat .env | grep SUPABASE_ACCESS_TOKEN | xargs) && \
   supabase db push
   ```
4. **é©—è­‰æ›´æ–°** â†’ ç¢ºèªé ç«¯è³‡æ–™åº«æ¬„ä½å¯¦éš›æ›´æ–°æˆåŠŸ
5. **è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥** â†’ ç¢ºä¿ç¾æœ‰è³‡æ–™å®Œå¥½ç„¡æ
6. **æ¸¬è©¦åŠŸèƒ½** â†’ ç¢ºä¿æ‡‰ç”¨ç¨‹å¼æ­£å¸¸é‹ä½œ

**æ³¨æ„äº‹é …ï¼š**
- SUPABASE_ACCESS_TOKEN å„²å­˜åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `.env` æª”æ¡ˆä¸­
- æ¯æ¬¡åŸ·è¡Œ migration å‰éœ€è¦å…ˆ `export` token
- ä½¿ç”¨ç³»çµ±çš„ `supabase` CLIï¼ˆä½æ–¼ `/usr/local/bin/supabase`ï¼‰

### UUID é©—è­‰æœ€ä½³å¯¦å‹™
**ğŸ”‘ æ ¸å¿ƒåŸå‰‡ï¼šé˜²ç¯„ç„¡æ•ˆè³‡æ–™é€²å…¥è³‡æ–™åº«**

**å¿…é ˆåŸ·è¡Œçš„é©—è­‰æª¢æŸ¥ï¼š**
1. **å¤šå±¤ç´šé©—è­‰** - åœ¨æœå‹™å‡½æ•¸å’Œè³‡æ–™ç®¡ç†å™¨ä¸­éƒ½è¦å¯¦ä½œ UUID é©—è­‰
2. **ç©ºå€¼æª¢æŸ¥** - çµ•ä¸å…è¨±ç©ºå­—ä¸²æˆ– null å€¼å‚³éåˆ°è³‡æ–™åº«æ“ä½œ
3. **æ ¼å¼é©—è­‰** - ç¢ºèª UUID ç¬¦åˆæ­£ç¢ºæ ¼å¼ï¼ˆ36 å­—å…ƒå«é€£å­—è™Ÿï¼‰
4. **é˜²ç¦¦æ€§ç¨‹å¼è¨­è¨ˆ** - åœ¨é—œéµè³‡æ–™æµç¨‹é»åŠ å…¥æª¢æŸ¥æ©Ÿåˆ¶

### é–‹ç™¼æµç¨‹
- ä¿®æ”¹è³‡æ–™åº«çµæ§‹æ™‚ï¼Œå‰µå»º migration æª”æ¡ˆ
- é‡å¤§è®Šæ›´å‰å…ˆå‚™ä»½ç›¸é—œæª”æ¡ˆ
- ä½¿ç”¨ `multi_replace_string_in_file` é€²è¡Œæ‰¹é‡ä¿®æ”¹

### ç”¨æˆ¶é«”é©—
- æä¾›è¼‰å…¥ç‹€æ…‹å’ŒéŒ¯èª¤è¨Šæ¯
- ç¢ºä¿èªè­‰å’ŒåŒ¿åç”¨æˆ¶éƒ½èƒ½æ­£å¸¸ä½¿ç”¨
- ä¿æŒ UI éŸ¿æ‡‰å¼è¨­è¨ˆ
- **ğŸ¯ æ‰‹æ©Ÿå„ªå…ˆ (Mobile-First)** - ä¸»è¦ç›®æ¨™ç‚ºæ‰‹æ©Ÿç€è¦½å™¨ä½¿ç”¨
- **ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ (RWD)** - ç¢ºä¿å„ç¨®è£ç½®éƒ½èƒ½è‰¯å¥½é¡¯ç¤º
- **è§¸æ§å‹å–„** - æŒ‰éˆ•å¤§å°é©åˆæ‰‹æŒ‡æ“ä½œ

### æª”æ¡ˆçµ„ç¹”
- Services æ”¾åœ¨ `services/` ç›®éŒ„
- çµ„ä»¶æ”¾åœ¨ `components/` ç›®éŒ„  
- é¡å‹å®šç¾©çµ±ä¸€åœ¨ `lib/supabase.ts`
- Migration æª”æ¡ˆä½¿ç”¨æ™‚é–“æˆ³å‘½å

## ğŸ² D&D 5E è¦å‰‡åˆè¦æ€§

### å¿…é ˆéµå®ˆçš„åŸå‰‡
- **æ‰€æœ‰åŠŸèƒ½å¿…é ˆç¬¦åˆ D&D 5E å®˜æ–¹è¦å‰‡**
- éŠæˆ²æ©Ÿåˆ¶ã€æ•¸å€¼è¨ˆç®—ã€è¡“èªä½¿ç”¨éƒ½è¦æº–ç¢º
- åƒè€ƒä¾†æºï¼š[D&D 5e Tools](https://5e.tools/)

### å¯¦ä½œæŒ‡å°
- ç”¨æˆ¶éœ€æ±‚ä¸æ˜ç¢ºæ™‚ï¼Œç›´æ¥æ¡ç”¨ D&D æ¨™æº–è¦å‰‡
- ç™¼ç¾ä¸ç¬¦åˆè¦å‰‡çš„ä¿®æ”¹æ™‚ï¼Œå¿…é ˆå‘ŠçŸ¥ç”¨æˆ¶
- å„ªå…ˆè€ƒæ…®éŠæˆ²å¹³è¡¡æ€§å’Œè¦å‰‡æ­£ç¢ºæ€§

## ğŸ”§ æŠ€è¡“æ£§è¦ç¯„

### å‰ç«¯æŠ€è¡“
- **React + TypeScript** - ä¸»è¦é–‹ç™¼æ¡†æ¶
- **Tailwind CSS** - æ¨£å¼ç³»çµ±
- **Vite** - å»ºç½®å·¥å…·

### é–‹ç™¼ç’°å¢ƒè¨­å®š
- **é–‹ç™¼ä¼ºæœå™¨** - æ°¸é ä½¿ç”¨ `localhost:3000` åŸ·è¡Œ `npm run dev`
- **ç«¯å£å›ºå®š** - ç¢ºä¿é–‹ç™¼ç’°å¢ƒä¸€è‡´æ€§ï¼Œé¿å…ç«¯å£è¡çªå•é¡Œ

### å¾Œç«¯èˆ‡è³‡æ–™åº«
- **Supabase** - å¾Œç«¯å³æœå‹™ (é ç«¯)
- **PostgreSQL** - è³‡æ–™åº«
- **Row Level Security (RLS)** - è³‡æ–™å®‰å…¨

## ç‰¹æ®Šæ³¨æ„äº‹é …

- é€™æ˜¯ä¸€å€‹ D&D è§’è‰²ç®¡ç†æ‡‰ç”¨
- æ”¯æ´å¤šè§’è‰²ç®¡ç†
- éœ€è¦è™•ç†æˆ°é¬¥ã€æŠ€èƒ½ã€ç‰©å“ç­‰éŠæˆ²å…ƒç´ 
- è€ƒæ…®æ‰‹æ©Ÿå’Œæ¡Œé¢ä½¿ç”¨é«”é©—

## ğŸ”„ æ¯æ—¥é–‹ç™¼æµç¨‹
- [ ] ç¢ºèªå°ˆæ¡ˆç‹€æ…‹å’Œå·²çŸ¥å•é¡Œ
- [ ] èˆ‡ç”¨æˆ¶è¨è«–ä¿®æ”¹è¨ˆåŠƒ
- [ ] ç²å¾—ç¢ºèªå¾ŒåŸ·è¡Œä¿®æ”¹
- [ ] **æŒä¹…åŒ–æª¢æŸ¥** - é©—è­‰æ‰€æœ‰ç‹€æ…‹æ›´æ–°éƒ½æœ‰å°æ‡‰çš„ä¿å­˜æ©Ÿåˆ¶
- [ ] **é‡è¼‰æ¸¬è©¦** - ç¢ºèªé é¢é‡è¼‰å¾Œç”¨æˆ¶è³‡æ–™å®Œæ•´
- [ ] æ¸¬è©¦ä¿®æ”¹çµæœ
- [ ] æ›´æ–°å°ˆæ¡ˆç‹€æ…‹

## âš¡ æ€§èƒ½å„ªåŒ–ç¶“é©— (å¿…é ˆéµå®ˆ)
**ğŸ¯ æ‡‰ç”¨åˆå§‹åŒ–å’Œè³‡æ–™è¼‰å…¥æ€§èƒ½å„ªåŒ–åŸå‰‡**

### å®Œæ•´æ¡ˆä¾‹ï¼šå¾ 53 ç§’å„ªåŒ–åˆ° 3 ç§’çš„å¯¦æˆ°ç¶“é©— (2026-01-29)

**åˆå§‹å•é¡Œï¼šæ‡‰ç”¨è¼‰å…¥è¶…é 53 ç§’**
- ç”¨æˆ¶å ±å‘Šï¼šåˆå§‹åŒ–è§¸ç™¼å…©æ¬¡ã€è§’è‰²è¼‰å…¥å¤±æ•—ã€ç¶“å¸¸è¶…æ™‚
- é€šé `performance.now()` å®šä½åˆ°ä¸‰å¤§ç“¶é ¸

---

### ğŸ“Š æ€§èƒ½å„ªåŒ–ç¸½è¦½

| éšæ®µ | å„ªåŒ–å‰ | å„ªåŒ–å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| èº«ä»½é©—è­‰ | 36.6s (å†—é¤˜èª¿ç”¨) | 0ms (å‚³éä¸Šä¸‹æ–‡) | **-100%** |
| è§’è‰²åˆ—è¡¨æŸ¥è©¢ | 11.8s â†’ 34.3s (å†·å•Ÿå‹•) | 1-2s (é‡è©¦æ©Ÿåˆ¶) | **-95%** |
| å®Œæ•´è§’è‰²è¼‰å…¥ | 92.7s (7å€‹æŸ¥è©¢) | 2.9s (å–®ä¸€JOIN) | **-97%** |
| è³‡æ–™åº«åˆå§‹åŒ– | å¡ä½/è¶…æ™‚ | 1-2s (é‡è©¦+è¶…æ™‚) | **ç©©å®š** |
| **ç¸½è¼‰å…¥æ™‚é–“** | **53-140s** | **3-5s** | **-95%** |

---

### æ ¸å¿ƒå•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

#### å•é¡Œä¸€ï¼šå†—é¤˜çš„èº«ä»½é©—è­‰èª¿ç”¨ï¼ˆ-36.6sï¼‰
**ç—‡ç‹€ï¼š** 
- `supabase.auth.getUser()` åœ¨å·²æœ‰ç”¨æˆ¶ç‹€æ…‹æ™‚ä»è¢«é‡è¤‡èª¿ç”¨
- é¦–æ¬¡èª¿ç”¨è€—æ™‚ 36.6 ç§’ï¼Œç¬¬äºŒæ¬¡åƒ… 132msï¼ˆèªªæ˜é¦–æ¬¡æœ‰å·¨å¤§é–‹éŠ·ï¼‰

**æ ¹æœ¬åŸå› ï¼š**
- AuthContext å·²ç¶“ç¶­è­·ç”¨æˆ¶ç‹€æ…‹
- æœå‹™å±¤ (DetailedCharacterService) ä»ç„¶é‡è¤‡èª¿ç”¨ `getCurrentUserContext()`
- æ¯æ¬¡è³‡æ–™æŸ¥è©¢éƒ½è§¸ç™¼ä¸å¿…è¦çš„èº«ä»½é©—è­‰æª¢æŸ¥

**è§£æ±ºæ–¹æ¡ˆ - å‚³éç”¨æˆ¶ä¸Šä¸‹æ–‡ï¼š**
```typescript
// âœ… æ­£ç¢ºåšæ³•ï¼šå¾ AuthContext å‚³éç”¨æˆ¶ä¸Šä¸‹æ–‡
const userContext = {
  isAuthenticated: true,
  userId: user.id
}
const characters = await HybridDataManager.getUserCharacters(userContext)

// âŒ éŒ¯èª¤åšæ³•ï¼šè®“æœå‹™å±¤è‡ªå·±ç²å–ç”¨æˆ¶ç‹€æ…‹
const characters = await HybridDataManager.getUserCharacters() // æœƒè§¸ç™¼ supabase.auth.getUser()
```

**å¯¦æ–½è¦é»ï¼š**
1. **æ‡‰ç”¨å±¤å‚³éä¸Šä¸‹æ–‡** - åœ¨ App.tsx ä½¿ç”¨ AuthContext çš„ user ç‹€æ…‹
2. **æœå‹™å±¤æ¥å—åƒæ•¸** - DetailedCharacterService å’Œ HybridDataManager éƒ½è¦æ”¯æ´ `userContext` åƒæ•¸
3. **å¯é¸åƒæ•¸è¨­è¨ˆ** - ä¿æŒå‘å¾Œå…¼å®¹ï¼Œ`userContext` ç‚ºå¯é¸åƒæ•¸
4. **æ•ˆæœé©—è­‰** - æ¶ˆé™¤ 36.6 ç§’çš„å†—é¤˜èª¿ç”¨ï¼Œæ¸›å°‘ ~70% çš„ç¸½è¼‰å…¥æ™‚é–“

#### å•é¡ŒäºŒï¼šä½æ•ˆçš„è³‡æ–™åº«æŸ¥è©¢ï¼ˆ11.8s â†’ 1.4sï¼‰
**ç—‡ç‹€ï¼š**
- ç°¡å–®çš„è§’è‰²åˆ—è¡¨æŸ¥è©¢è€—æ™‚ 11.8 ç§’
- è³‡æ–™åº«çµæ§‹ç°¡å–®ä¸”è³‡æ–™é‡å°‘ï¼Œç†æ‡‰æ¥µå¿«

**æ ¹æœ¬åŸå› ï¼š**
- ä½¿ç”¨ `SELECT *` æŸ¥è©¢æ‰€æœ‰æ¬„ä½ï¼ˆåŒ…æ‹¬ä¸éœ€è¦çš„ï¼‰
- ç¼ºå°‘ `ORDER BY` å­å¥ï¼Œè³‡æ–™åº«éœ€è¦é¡å¤–è™•ç†
- æŸ¥è©¢æœªæ˜ç¢ºæŒ‡å®šéœ€è¦çš„æ¬„ä½

**è§£æ±ºæ–¹æ¡ˆ - æŸ¥è©¢å„ªåŒ–ï¼š**
```typescript
// âœ… æ­£ç¢ºåšæ³•ï¼šæ˜ç¢ºæŒ‡å®šæ¬„ä½å’Œæ’åº
let query = supabase
  .from('characters')
  .select('id, user_id, anonymous_id, name, character_class, level, experience, avatar_url, is_anonymous, created_at, updated_at')
  .order('updated_at', { ascending: false })

// âŒ éŒ¯èª¤åšæ³•ï¼šä½¿ç”¨ SELECT * ä¸”ç„¡æ’åº
let query = supabase.from('characters').select('*')
```

**å¯¦æ–½è¦é»ï¼š**
1. **æ˜ç¢ºæ¬„ä½åˆ—è¡¨** - åªæŸ¥è©¢å¯¦éš›éœ€è¦çš„æ¬„ä½
2. **æ·»åŠ æ’åº** - ä½¿ç”¨ `ORDER BY` è®“è³‡æ–™åº«åˆ©ç”¨ç´¢å¼•
3. **é¿å…é€šé…ç¬¦** - ä¸ä½¿ç”¨ `SELECT *`
4. **æ•ˆæœé©—è­‰** - æŸ¥è©¢æ™‚é–“å¤§å¹…é™ä½

#### å•é¡Œä¸‰ï¼šRLS æ”¿ç­–å­æŸ¥è©¢é–‹éŠ·ï¼ˆ92.7s â†’ 2.9sï¼Œé—œéµå„ªåŒ–ï¼‰
**ç—‡ç‹€ï¼š**
- å¤šå€‹ä¸¦è¡ŒæŸ¥è©¢ï¼ˆ7å€‹ï¼‰è€—æ™‚æ¥µé•·ï¼ˆ92.7ç§’ï¼‰
- æ¯å€‹å­è¡¨æŸ¥è©¢å¹³å‡ 13 ç§’
- å‰›å®Œæˆçš„è§’è‰²åˆ—è¡¨æŸ¥è©¢å¾ˆå¿«ï¼ˆ1.4ç§’ï¼‰ï¼Œèªªæ˜ä¸æ˜¯å†·å•Ÿå‹•

**æ ¹æœ¬åŸå› ï¼š**
- **æ¯å€‹å­è¡¨çš„ RLS æ”¿ç­–éƒ½åŸ·è¡Œ `EXISTS` å­æŸ¥è©¢** åˆ° characters è¡¨
- 7 å€‹ä¸¦è¡ŒæŸ¥è©¢ = 7 æ¬¡ç¨ç«‹çš„ RLS æª¢æŸ¥ + 7 æ¬¡ `auth.uid()` èª¿ç”¨
- RLS æ”¿ç­–ç¯„ä¾‹ï¼š
```sql
CREATE POLICY "Users can view own character ability scores" ON character_ability_scores FOR ALL USING (
  EXISTS (SELECT 1 FROM characters WHERE characters.id = character_ability_scores.character_id 
    AND auth.uid() = characters.user_id)
);
```
- æ¯æ¬¡æŸ¥è©¢éƒ½è¦ï¼šæª¢æŸ¥èº«ä»½ â†’ å­æŸ¥è©¢ characters è¡¨ â†’ é©—è­‰æ¬Šé™

**è§£æ±ºæ–¹æ¡ˆ - ä½¿ç”¨å–®ä¸€ JOIN æŸ¥è©¢ï¼š**
```typescript
// âœ… æ­£ç¢ºåšæ³•ï¼šå–®ä¸€æŸ¥è©¢ + JOINï¼Œè®“ Supabase è‡ªå‹•æ‰¾å¤–éµ
const { data } = await supabase
  .from('characters')
  .select(`
    *,
    character_ability_scores(*),
    character_current_stats(*),
    character_currency(*),
    character_saving_throws(*),
    character_skill_proficiencies(*),
    character_combat_actions(*)
  `)
  .eq('id', characterId)
  .single()

// âŒ éŒ¯èª¤åšæ³•ï¼šå¤šå€‹ä¸¦è¡ŒæŸ¥è©¢ï¼Œæ¯å€‹éƒ½è§¸ç™¼ RLS æª¢æŸ¥
const [char, abilities, stats] = await Promise.all([
  supabase.from('characters').select('*').eq('id', characterId),
  supabase.from('character_ability_scores').select('*').eq('character_id', characterId),
  supabase.from('character_current_stats').select('*').eq('character_id', characterId)
])
```

**å¯¦æ–½è¦é»ï¼š**
1. **ä½¿ç”¨ç°¡åŒ–çš„ JOIN èªæ³•** - `table_name(*)` è®“ Supabase è‡ªå‹•æ‰¾åˆ°å¤–éµé—œä¿‚
2. **é¿å…æ‰‹å‹•æŒ‡å®šå¤–éµåç¨±** - `table!foreign_key_name (*)` èªæ³•å®¹æ˜“å‡ºéŒ¯
3. **åªåœ¨ä¸»è¡¨æª¢æŸ¥ RLS** - characters è¡¨æª¢æŸ¥ä¸€æ¬¡ï¼Œå­è¡¨é€šé JOIN è‡ªå‹•é—œè¯
4. **æ¸›å°‘ `auth.uid()` èª¿ç”¨** - å¾ 7 æ¬¡æ¸›å°‘åˆ° 1 æ¬¡
5. **âš ï¸ é—œéµï¼šæ­£ç¢ºè™•ç† JOIN è¿”å›çš„æ•¸æ“šçµæ§‹** - è¦‹ä¸‹æ–¹èªªæ˜
4. **æå–åµŒå¥—æ•¸æ“š** - JOIN çµæœæœƒæœ‰åµŒå¥—é™£åˆ—ï¼Œéœ€è¦å±•å¹³è™•ç†

**æ€§èƒ½å°æ¯”ï¼š**
- ä¸¦è¡Œ 7 å€‹æŸ¥è©¢ï¼š92.7 ç§’ï¼ˆæ¯å€‹ ~13 ç§’ï¼‰
- å–®ä¸€ JOIN æŸ¥è©¢ï¼š2.9 ç§’ï¼ˆ**æ”¹å–„ 97%**ï¼‰

**è­˜åˆ¥æ­¤å•é¡Œçš„ç‰¹å¾µï¼š**
- âš ï¸ ä¸¦è¡ŒæŸ¥è©¢æ•¸é‡è¶Šå¤šï¼Œç¸½æ™‚é–“è¶Šé•·
- âš ï¸ æ¯å€‹å­è¡¨æŸ¥è©¢æ™‚é–“ç›¸ä¼¼ï¼ˆéƒ½åœ¨åŸ·è¡Œé¡ä¼¼çš„ RLS æª¢æŸ¥ï¼‰
- âš ï¸ ä¸»è¡¨æŸ¥è©¢å¾ˆå¿«ï¼Œä½†å­è¡¨æŸ¥è©¢å¾ˆæ…¢
- âš ï¸ è³‡æ–™é‡å¾ˆå°‘ä½†æŸ¥è©¢å¾ˆæ…¢

**ğŸ”¥ é‡è¦ï¼šJOIN æŸ¥è©¢çš„æ•¸æ“šæå–é™·é˜±ï¼ˆå¿…è®€ï¼‰**

Supabase JOIN å°ä¸åŒé—œä¿‚é¡å‹è¿”å›ä¸åŒçš„æ•¸æ“šçµæ§‹ï¼š

**ä¸€å°ä¸€é—œä¿‚**ï¼ˆè¡¨ä¸­æœ‰ `UNIQUE(foreign_key)` ç´„æŸï¼‰ï¼š
```typescript
// âš ï¸ è¿”å› objectï¼Œä¸æ˜¯ arrayï¼
character.character_ability_scores    // â†’ {id: 1, strength: 10, ...}
character.character_current_stats     // â†’ {id: 2, current_hp: 20, ...}
character.character_currency          // â†’ {id: 3, gp: 100, ...}
```

**ä¸€å°å¤šé—œä¿‚**ï¼ˆè¡¨ä¸­ç„¡ `UNIQUE(foreign_key)` ç´„æŸï¼‰ï¼š
```typescript
// âœ… è¿”å› array
character.character_saving_throws      // â†’ [{ability: 'str'}, {ability: 'dex'}]
character.character_skill_proficiencies // â†’ [{skill_name: 'é‹å‹•'}, ...]
character.character_combat_actions     // â†’ [{name: 'æ”»æ“Š'}, ...]
```

**æ­£ç¢ºçš„æ•¸æ“šæå–æ–¹å¼ï¼š**
```typescript
// âœ… æ­£ç¢ºï¼šåŒæ™‚è™•ç† object å’Œ array
const abilityScores = character.character_ability_scores
  ? (Array.isArray(character.character_ability_scores)
      ? character.character_ability_scores[0]  // å¦‚æœæ˜¯ array å–ç¬¬ä¸€å€‹
      : character.character_ability_scores)     // å¦‚æœæ˜¯ object ç›´æ¥ç”¨
  : null

// âŒ éŒ¯èª¤ï¼šåªæª¢æŸ¥ Array.isArray() æœƒå°è‡´ä¸€å°ä¸€é—œä¿‚æ•¸æ“šä¸Ÿå¤±
const abilityScores = Array.isArray(character.character_ability_scores) && 
  character.character_ability_scores.length > 0
    ? character.character_ability_scores[0]
    : null  // ä¸€å°ä¸€é—œä¿‚æœƒèµ°åˆ°é€™è£¡ï¼Œå°è‡´æ•¸æ“šä¸Ÿå¤±ï¼
```

**è¨ºæ–·æŠ€å·§ï¼š**
```typescript
console.log('æ•¸æ“šé¡å‹:', Array.isArray(data) ? 'array' : typeof data)
// ä¸€å°ä¸€ï¼šobject
// ä¸€å°å¤šï¼šarray
```

#### å•é¡Œå››ï¼šSupabase å†·å•Ÿå‹•å•é¡Œï¼ˆé‡è¦ï¼‰
**ä½¿ç”¨ performance.now() å®šä½ç“¶é ¸ï¼š**
```typescript
const startTime = performance.now()
// ... åŸ·è¡Œæ“ä½œ ...
const duration = performance.now() - startTime
console.log(`â±ï¸ æ“ä½œè€—æ™‚: ${duration.toFixed(1)}ms`)
```

**é—œéµæ¸¬é‡é»ï¼š**
- ç·©å­˜æª¢æŸ¥æ™‚é–“
- èº«ä»½é©—è­‰æ™‚é–“
- è³‡æ–™åº«æŸ¥è©¢æ™‚é–“  
- ç¸½é«”æ“ä½œæ™‚é–“

**æ•ˆèƒ½ç›®æ¨™ï¼š**
- ç·©å­˜å‘½ä¸­: < 1ms
- èº«ä»½é©—è­‰: < 200ms (å·²æœ‰ä¸Šä¸‹æ–‡æ™‚æ‡‰ç‚º 0ms)
- è³‡æ–™åº«æŸ¥è©¢: < 500ms (ç°¡å–®æŸ¥è©¢)
- ç¸½åˆå§‹åŒ–: < 3s

#### å•é¡Œäº”ï¼šè³‡æ–™åº«åˆå§‹åŒ–å¡ä½
**ç—‡ç‹€ï¼š**
- æ‡‰ç”¨å¡åœ¨ "åˆå§‹åŒ–è³‡æ–™åº«æœå‹™..." éšæ®µ
- æ²’æœ‰éŒ¯èª¤è¨Šæ¯ï¼Œç„¡é™ç­‰å¾…

**æ ¹æœ¬åŸå› ï¼š**
- è³‡æ–™åº«æª¢æŸ¥æŸ¥è©¢é‡åˆ°å†·å•Ÿå‹•ï¼Œä½†æ²’æœ‰è¶…æ™‚ä¿è­·
- æ²’æœ‰é‡è©¦æ©Ÿåˆ¶ï¼Œä¸€æ¬¡å¤±æ•—å°±æ°¸ä¹…å¡ä½

**è§£æ±ºæ–¹æ¡ˆ - è¶…æ™‚ä¿è­· + é‡è©¦ï¼š**
```typescript
// âœ… æ­£ç¢ºåšæ³•ï¼šæ·»åŠ è¶…æ™‚å’Œé‡è©¦
const timeoutPromise = new Promise<never>((_, reject) => {
  setTimeout(() => reject(new Error('è³‡æ–™åº«é€£æ¥è¶…æ™‚')), 10000)
})

const checkPromise = supabase.from('characters').select('id').limit(1)
const { error } = await Promise.race([checkPromise, timeoutPromise])

// å¦‚æœå¤±æ•—ï¼Œè‡ªå‹•é‡è©¦
if (error && attempt < maxRetries) {
  await new Promise(resolve => setTimeout(resolve, 1000))
  continue
}
```

**å¯¦æ–½è¦é»ï¼š**
1. **è¨­å®šåˆç†è¶…æ™‚** - 10 ç§’è¶³å¤ æª¢æ¸¬é€£æ¥å•é¡Œ
2. **è‡ªå‹•é‡è©¦** - æª¢æ¸¬å†·å•Ÿå‹•éŒ¯èª¤æ™‚é‡è©¦ 1-2 æ¬¡
3. **å»¶é²é‡è©¦** - ç­‰å¾… 1 ç§’çµ¦ä¼ºæœå™¨æ™‚é–“å•Ÿå‹•
4. **é˜²æ­¢å¡æ­»** - ç¢ºä¿æ‰€æœ‰é—œéµæŸ¥è©¢éƒ½æœ‰è¶…æ™‚ä¿è­·

### é€šç”¨å„ªåŒ–åŸå‰‡
1. **é¿å…å†—é¤˜ API èª¿ç”¨** - åˆ©ç”¨å·²æœ‰çš„ç‹€æ…‹ç®¡ç†é¿å…é‡è¤‡è«‹æ±‚
2. **æ˜ç¢ºæŸ¥è©¢éœ€æ±‚** - æ°¸é æŒ‡å®šéœ€è¦çš„æ¬„ä½ï¼Œé¿å… `SELECT *`
3. **æ·»åŠ æ€§èƒ½æ¸¬é‡** - ä½¿ç”¨ `performance.now()` å®šä½ç“¶é ¸
4. **ä¸Šä¸‹æ–‡å‚³é** - å¾é ‚å±¤å‚³éå·²çŸ¥ä¿¡æ¯ï¼Œé¿å…åº•å±¤é‡è¤‡ç²å–
5. **æŸ¥è©¢æ’åº** - æ·»åŠ  `ORDER BY` å¹«åŠ©è³‡æ–™åº«ä½¿ç”¨ç´¢å¼•
6. **ä½¿ç”¨ JOIN è€Œéå¤šæ¬¡æŸ¥è©¢** - æ¸›å°‘ RLS æª¢æŸ¥æ¬¡æ•¸ï¼Œå–®ä¸€æŸ¥è©¢æ¯”å¤šå€‹ä¸¦è¡ŒæŸ¥è©¢å¿«å¾—å¤š

#### å•é¡Œå››ï¼šSupabase å†·å•Ÿå‹•å•é¡Œ
**ç—‡ç‹€ï¼š**
- ç¬¬ä¸€æ¬¡è«‹æ±‚è¿”å› 520 éŒ¯èª¤æˆ– CORS éŒ¯èª¤
- è€—æ™‚æ¥µé•·ï¼ˆ40-50 ç§’ï¼‰ç„¶å¾Œå¤±æ•—
- ç¬¬äºŒæ¬¡è«‹æ±‚ç«‹å³æˆåŠŸï¼Œæ­£å¸¸é€Ÿåº¦ï¼ˆ200-300msï¼‰

**æ ¹æœ¬åŸå› ï¼š**
- **Supabase å…è²»å±¤å°ˆæ¡ˆæœƒä¼‘çœ ** - é–’ç½®ä¸€æ®µæ™‚é–“å¾Œè‡ªå‹•æš«åœ
- ç¬¬ä¸€æ¬¡è«‹æ±‚è§¸ç™¼å°ˆæ¡ˆå–šé†’ï¼Œä½†å–šé†’éç¨‹å¯èƒ½è¶…æ™‚
- å¸¸è¦‹éŒ¯èª¤ï¼š`520 Web Server Returned an Unknown Error`ã€CORS éŒ¯èª¤ã€`Failed to fetch`

**è§£æ±ºæ–¹æ¡ˆ - å¯¦æ–½é‡è©¦æ©Ÿåˆ¶ï¼š**
```typescript
// âœ… æ­£ç¢ºåšæ³•ï¼šæª¢æ¸¬å†·å•Ÿå‹•éŒ¯èª¤ä¸¦è‡ªå‹•é‡è©¦
const maxRetries = 2
for (let attempt = 1; attempt <= maxRetries; attempt++) {
  try {
    if (attempt > 1) {
      console.log(`ğŸ”„ é‡è©¦ç¬¬ ${attempt} æ¬¡...`)
      await new Promise(resolve => setTimeout(resolve, 1000))
    }
    
    const result = await supabase.from('table').select('*')
    
    if (result.error) {
      // æª¢æ¸¬å€¼å¾—é‡è©¦çš„éŒ¯èª¤
      const errorMessage = result.error.message || ''
      if (errorMessage.includes('CORS') || errorMessage.includes('520') || 
          errorMessage.includes('502') || errorMessage.includes('503') ||
          errorMessage.includes('Failed to fetch')) {
        if (attempt < maxRetries) {
          continue // é‡è©¦
        }
      }
    }
    
    return result.data
  } catch (error) {
    if (attempt < maxRetries) continue
    throw error
  }
}
```

**å¯¦æ–½è¦é»ï¼š**
1. **è‡ªå‹•é‡è©¦** - æª¢æ¸¬åˆ°å†·å•Ÿå‹•éŒ¯èª¤ï¼ˆ520, CORS, 502, 503ï¼‰æ™‚è‡ªå‹•é‡è©¦ 1-2 æ¬¡
2. **å»¶é²é‡è©¦** - ç¬¬ä¸€æ¬¡å¤±æ•—å¾Œç­‰å¾… 1 ç§’å†é‡è©¦ï¼Œçµ¦ä¼ºæœå™¨æ™‚é–“å®Œæˆå•Ÿå‹•
3. **éŒ¯èª¤åˆ†é¡** - å€åˆ†ç¶²è·¯/ä¼ºæœå™¨éŒ¯èª¤ï¼ˆå€¼å¾—é‡è©¦ï¼‰vs è³‡æ–™éŒ¯èª¤ï¼ˆä¸å€¼å¾—é‡è©¦ï¼‰
4. **ç”¨æˆ¶é«”é©—** - ç¬¬ä¸€æ¬¡å¤±æ•—ä¸é©šæ…Œï¼Œè‡ªå‹•é‡è©¦é€šå¸¸èƒ½æˆåŠŸ

**è­˜åˆ¥å†·å•Ÿå‹•å•é¡Œçš„ç‰¹å¾µï¼š**
- âš ï¸ é¦–æ¬¡è«‹æ±‚å¤±æ•—ï¼Œå¾ŒçºŒè«‹æ±‚æˆåŠŸ
- âš ï¸ éŒ¯èª¤è¨Šæ¯åŒ…å« "CORS", "520", "502", "503", "Failed to fetch"
- âš ï¸ è«‹æ±‚è€—æ™‚ç•°å¸¸é•·ï¼ˆ30-50 ç§’ï¼‰
- âš ï¸ ç„¡éœ€ä¿®æ”¹ä»£ç¢¼ï¼Œé‡æ–°è¼‰å…¥é é¢é€šå¸¸èƒ½è§£æ±º

**é é˜²æªæ–½ï¼ˆå¯é¸ï¼‰ï¼š**
- ä½¿ç”¨ä»˜è²»ç‰ˆ Supabaseï¼ˆå°ˆæ¡ˆä¸ä¼‘çœ ï¼‰
- å¯¦æ–½å®šæœŸ ping æ©Ÿåˆ¶ä¿æŒå°ˆæ¡ˆæ´»èº
- å‘ç”¨æˆ¶å±•ç¤ºå‹å¥½çš„è¼‰å…¥æç¤º

---

### é€šç”¨å„ªåŒ–åŸå‰‡ï¼ˆå¿…é ˆéµå®ˆï¼‰
1. **é¿å…å†—é¤˜ API èª¿ç”¨** - åˆ©ç”¨å·²æœ‰çš„ç‹€æ…‹ç®¡ç†é¿å…é‡è¤‡è«‹æ±‚
2. **æ˜ç¢ºæŸ¥è©¢éœ€æ±‚** - æ°¸é æŒ‡å®šéœ€è¦çš„æ¬„ä½ï¼Œé¿å… `SELECT *`
3. **æ·»åŠ æ€§èƒ½æ¸¬é‡** - ä½¿ç”¨ `performance.now()` å®šä½ç“¶é ¸
4. **ä¸Šä¸‹æ–‡å‚³é** - å¾é ‚å±¤å‚³éå·²çŸ¥ä¿¡æ¯ï¼Œé¿å…åº•å±¤é‡è¤‡ç²å–
5. **æŸ¥è©¢æ’åº** - æ·»åŠ  `ORDER BY` å¹«åŠ©è³‡æ–™åº«ä½¿ç”¨ç´¢å¼•
6. **ä½¿ç”¨ JOIN è€Œéå¤šæ¬¡æŸ¥è©¢** - æ¸›å°‘ RLS æª¢æŸ¥æ¬¡æ•¸ï¼Œå–®ä¸€æŸ¥è©¢æ¯”å¤šå€‹ä¸¦è¡ŒæŸ¥è©¢å¿«å¾—å¤š
7. **å¯¦æ–½é‡è©¦æ©Ÿåˆ¶** - æª¢æ¸¬ç¶²è·¯/ä¼ºæœå™¨éŒ¯èª¤æ™‚è‡ªå‹•é‡è©¦
8. **è¶…æ™‚ä¿è­·** - é˜²æ­¢æŸ¥è©¢æ°¸ä¹…å¡ä½

### å„ªåŒ–æª¢æŸ¥æ¸…å–®

**åœ¨å¯¦æ–½è³‡æ–™è¼‰å…¥åŠŸèƒ½æ™‚ï¼Œå¿…é ˆæª¢æŸ¥ï¼š**
- [ ] æ˜¯å¦é¿å…äº†å†—é¤˜çš„èº«ä»½é©—è­‰èª¿ç”¨ï¼Ÿ
- [ ] æ˜¯å¦æ˜ç¢ºæŒ‡å®šäº†æŸ¥è©¢æ¬„ä½ï¼ˆé¿å… `SELECT *`ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ JOIN è€Œéå¤šå€‹ç¨ç«‹æŸ¥è©¢ï¼Ÿ
- [ ] **æ˜¯å¦æ­£ç¢ºè™•ç† JOIN è¿”å›çš„æ•¸æ“šçµæ§‹ï¼ˆä¸€å°ä¸€ = objectï¼Œä¸€å°å¤š = arrayï¼‰ï¼Ÿ**
- [ ] æ˜¯å¦æ·»åŠ äº†æ€§èƒ½æ¸¬é‡æ—¥èªŒï¼Ÿ
- [ ] æ˜¯å¦å¯¦æ–½äº†é‡è©¦æ©Ÿåˆ¶è™•ç†å†·å•Ÿå‹•ï¼Ÿ
- [ ] æ˜¯å¦è¨­å®šäº†åˆç†çš„è¶…æ™‚æ™‚é–“ï¼Ÿ
- [ ] æ˜¯å¦å¾ä¸Šå±¤å‚³éäº† userContextï¼Ÿ

**Debug æ€§èƒ½å•é¡Œæ™‚ï¼Œå¿…é ˆæ¸¬é‡ï¼š**
- [ ] ç·©å­˜æª¢æŸ¥æ™‚é–“
- [ ] èº«ä»½é©—è­‰æ™‚é–“
- [ ] æ¯å€‹è³‡æ–™åº«æŸ¥è©¢çš„æ™‚é–“
- [ ] ç¸½é«”æ“ä½œæ™‚é–“
- [ ] æ˜¯å¦å­˜åœ¨é‡è¤‡èª¿ç”¨ï¼Ÿ

## æ›´æ–°è¨˜éŒ„

- 2026-01-29: å®Œæ•´è¨˜éŒ„è¼‰å…¥é€Ÿåº¦å„ªåŒ–æ¡ˆä¾‹ï¼ˆ53sâ†’3sï¼‰åŒ…å« 5 å¤§å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆ
- 2026-01-29: æ·»åŠ å„ªåŒ–æª¢æŸ¥æ¸…å–®ï¼Œç¢ºä¿æœªä¾†é–‹ç™¼éµå¾ªæœ€ä½³å¯¦è¸
- 2026-01-27: ç§»é™¤ localStorageï¼Œæ”¹ç”¨å®Œæ•´ database æ¶æ§‹
- 2026-01-27: æ·»åŠ  user_settings è¡¨å’Œç‰©å“ç®¡ç†ç³»çµ±
- 2026-01-27: æ•´åˆåŸ .assistant-notes.md å…§å®¹ï¼ŒåŠ å¼·å·¥ä½œæµç¨‹è¦ç¯„